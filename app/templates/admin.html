{% extends "base.html" %}

{% block title %}Admin Dashboard - Wii Party U Deluxe{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Admin Dashboard</h1>
    <p>Willkommen im Admin-Bereich, {{ current_user.username }}!</p>

    <div class="card mb-4">
        <div class="card-header bg-info text-white">
            Aktuelles Spiel / Status
        </div>
        <div class="card-body">
            <h5 class="card-title">Aktuell ausgewähltes Minispiel: {{ current_minigame_title }}</h5>
            {% if current_minigame_is_video and current_video_filename %}
                <p>Typ: Video-Minispiel (Datei: {{ current_video_filename }})</p>
                <a href="{{ url_for('admin.enter_video_scores', video_filename=current_video_filename) }}" class="btn btn-warning btn-sm">Scores für Video eingeben</a>
            {% elif current_minigame_id %}
                <p>Typ: Datenbank-Minispiel (ID: {{ current_minigame_id }})</p>
                <a href="{{ url_for('admin.enter_scores', minigame_id=current_minigame_id) }}" class="btn btn-warning btn-sm">Scores für DB-Spiel eingeben</a>
            {% else %}
                <p>Derzeit ist kein spezifisches Minispiel aktiv oder ausgewählt.</p>
            {% endif %}
        </div>
    </div>

    <div class="mb-4 p-3 border rounded">
        <h4>Spielsteuerung</h4>
        <form method="POST" action="{{ url_for('admin.start_random_minigame') }}" class="mb-2">
            <button type="submit" class="btn btn-success"><i class="fas fa-random"></i> Zufälliges Minispiel starten/auswählen</button>
        </form>
        

        
        <form method="POST" action="{{ url_for('admin.reset_game_state') }}" onsubmit="return confirm('Wirklich den gesamten Spielstatus (aktive Session beenden, aktuelles Minispiel zurücksetzen) zurücksetzen? Scores bleiben erhalten.');" class="mb-2">
            <button type="submit" class="btn btn-danger"><i class="fas fa-power-off"></i> Spielsitzung zurücksetzen</button>
        </form>
         <a href="{{ url_for('admin.init_chars') }}" class="btn btn-secondary btn-sm"><i class="fas fa-users-cog"></i> Charaktere initialisieren</a>
    </div>


    <div class="mb-4">
        <h2>Team Management</h2>
        <a href="{{ url_for('admin.create_team') }}" class="btn btn-primary mb-3"><i class="fas fa-plus-circle"></i> Neues Team erstellen</a>
        {% if teams %}
            <ul class="list-group">
                {% for team in teams %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        {{ team.name }} (Charakter: {{ team.character_name or 'Kein Charakter' }})
                        <span>
                            <a href="{{ url_for('admin.edit_team', team_id=team.id) }}" class="btn btn-sm btn-outline-secondary mr-2"><i class="fas fa-edit"></i> Bearbeiten</a>
                            <form method="POST" action="{{ url_for('admin.delete_team', team_id=team.id) }}" style="display: inline;" onsubmit="return confirm('Team {{ team.name }} wirklich löschen? Alle Scores dieses Teams gehen verloren!');">
                                <button type="submit" class="btn btn-sm btn-outline-danger"><i class="fas fa-trash-alt"></i> Löschen</button>
                            </form>
                        </span>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>Noch keine Teams erstellt.</p>
        {% endif %}
    </div>

    <div class="mb-4">
        <h2>Minispiel Management (Datenbank)</h2>
        <a href="{{ url_for('admin.create_minigame') }}" class="btn btn-primary mb-3"><i class="fas fa-plus-circle"></i> Neues DB-Minispiel erstellen</a>
        {% if minigames_db %}
            <ul class="list-group">
                {% for minigame in minigames_db %}
                    {% if not minigame.is_video_game %} {# Stelle sicher, dass es kein Video-Minispiel-Eintrag ist #}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            {{ minigame.name }}
                            <span>
                                <a href="{{ url_for('admin.edit_minigame', minigame_id=minigame.id) }}" class="btn btn-sm btn-outline-secondary mr-2"><i class="fas fa-edit"></i> Bearbeiten</a>
                                <form method="POST" action="{{ url_for('admin.delete_minigame', minigame_id=minigame.id) }}" style="display: inline;" onsubmit="return confirm('Minispiel {{ minigame.name }} wirklich löschen? Alle Scores für dieses Spiel gehen verloren!');">
                                    <button type="submit" class="btn btn-sm btn-outline-danger"><i class="fas fa-trash-alt"></i> Löschen</button>
                                </form>
                            </span>
                        </li>
                    {% endif %}
                {% endfor %}
            </ul>
        {% else %}
            <p>Noch keine Datenbank-Minispiele erstellt.</p>
        {% endif %}
    </div>

    <div class="mb-4">
        <h2>Video Minispiele (aus Ordner geladen)</h2>
        {% if video_minigames %}
            <ul class="list-group">
                {% for video_game in video_minigames %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        {{ video_game.title }} ({{ video_game.filename }})
                        <a href="{{ url_for('admin.enter_video_scores', video_filename=video_game.filename) }}" class="btn btn-sm btn-outline-info"><i class="fas fa-star"></i> Scores für Video</a>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>Keine Video-Minispiele im Ordner <code>{{ current_app.config.MINIGAME_VIDEO_FOLDER }}</code> gefunden oder Ordner existiert nicht.</p>
        {% endif %}
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js"></script>

{% endblock %}
